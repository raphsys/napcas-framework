\doxysection{attention.\+h}
\hypertarget{attention_8h_source}{}\label{attention_8h_source}\index{cpp/include/attention.h@{cpp/include/attention.h}}
\mbox{\hyperlink{attention_8h}{Aller à la documentation de ce fichier.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ File:\ cpp/include/attention.h}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#ifndef\ ATTENTION\_H}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#define\ ATTENTION\_H}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{module_8h}{module.h}}"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tensor_8h}{tensor.h}}"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{linear_8h}{linear.h}}"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classMultiHeadAttention}{MultiHeadAttention}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classModule}{Module}}\ \{}
\DoxyCodeLine{00015\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00018\ \ \ \ \ \mbox{\hyperlink{classMultiHeadAttention_aa1aecfb653918f4ba0fdd03f4fd45971}{MultiHeadAttention}}(\textcolor{keywordtype}{int}\ d\_model,\ \textcolor{keywordtype}{int}\ num\_heads);}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMultiHeadAttention_a8c88a48bb4d45b0f72bead15f38ba4fb}{forward}}(\mbox{\hyperlink{classTensor}{Tensor}}\&\ input,\ \mbox{\hyperlink{classTensor}{Tensor}}\&\ output)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMultiHeadAttention_a1af4ff2e9f2541ff5eedc58541bcb4e7}{forward}}(\mbox{\hyperlink{classTensor}{Tensor}}\&\ query,}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\&\ key,}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\&\ value,}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\&\ output);}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMultiHeadAttention_ace2a7e78ddebff1da9c7680083706b83}{backward}}(\mbox{\hyperlink{classTensor}{Tensor}}\&\ grad\_output,\ \mbox{\hyperlink{classTensor}{Tensor}}\&\ grad\_input)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMultiHeadAttention_ad8c1572f6d3d3dec761ded4b4246657a}{update}}(\textcolor{keywordtype}{float}\ lr)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\&\ \mbox{\hyperlink{classMultiHeadAttention_af7dacb69f88980441e2240e59e31ca4c}{get\_weights}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ weights\_;\ \}}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\&\ \mbox{\hyperlink{classMultiHeadAttention_a194b5792bc0f34f7c50d3188f7d11724}{get\_grad\_weights}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ grad\_weights\_;\ \}}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMultiHeadAttention_a6dbbe962032f0d53726cba3c332f70b9}{set\_weights}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTensor}{Tensor}}\&\ weights)\textcolor{keyword}{\ override\ }\{\ weights\_\ =\ weights;\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMultiHeadAttention_ae8e1d6e71ff98d5d9a4e39900b9fb4bd}{save}}(\textcolor{keyword}{const}\ std::string\&\ path)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMultiHeadAttention_a7460085fb474cf99f32713291708278a}{load}}(\textcolor{keyword}{const}\ std::string\&\ path)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{int}\ d\_model\_;}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_heads\_;}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{int}\ d\_k\_;}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{int}\ chunk\_size\_;}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ projections\ Q/K/V\ et\ projection\ finale}}
\DoxyCodeLine{00049\ \ \ \ \ std::vector<std::shared\_ptr<Linear>>\ w\_q\_,\ w\_k\_,\ w\_v\_;}
\DoxyCodeLine{00050\ \ \ \ \ std::shared\_ptr<Linear>\ w\_o\_;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{//\ placeholders\ pour\ sérialisation}}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\ weights\_;}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\ grad\_weights\_;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ caches\ pour\ backward}}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\ attention\_weights\_;\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ [seq\_len,\ seq\_len,\ batch,\ num\_heads]}}
\DoxyCodeLine{00058\ \ \ \ \ std::vector<Tensor>\ q\_cache\_,\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ un\ Tensor\ par\ tête:\ [seq\_len,\ batch,\ d\_k]}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ k\_cache\_,}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v\_cache\_;}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{classTensor}{Tensor}}\ concat\_cache\_;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ concaténation\ avant\ w\_o\_:\ [seq\_len,\ batch,\ d\_model]}}
\DoxyCodeLine{00062\ \};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ ATTENTION\_H}}
\DoxyCodeLine{00065\ }

\end{DoxyCode}
